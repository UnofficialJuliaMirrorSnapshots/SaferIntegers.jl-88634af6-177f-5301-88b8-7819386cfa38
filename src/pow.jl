const maxpowUInt128 = Int8[ 0,
63, 55, 49, 45, 42, 41, 39, 37, 35, 35, 34, 33, 31, 32, 31, 31, 29, 29, 29, 28, 28, 27, 27, 27, 27, 27, 26, 26, 25, 26, 25, 25, 26, 25, 24, 25, 24, 24, 24, 25, 23, 24, 24, 23, 24, 24, 23, 24, 24, 23, 26, 22, 22, 24, 22, 24, 22, 22, 22, 23, 21, 23, 22, 23, 21, 23, 23, 22, 21, 21, 21, 21, 23, 20, 21, 21, 20, 20, 20, 22, 20, 21, 21, 20, 21, 20, 20, 22, 20, 20, 20, 22, 20, 20, 21, 19, 21, 20, 20, 19, 19, 20, 19, 20, 20, 20, 19, 20, 19, 19, 20, 20, 19, 19, 19, 18, 21, 19, 19, 18, 20, 20, 19, 19, 18, ];

const maxpowUInt64 = Int8[ 0,
63, 41, 31, 27, 25, 23, 21, 21, 19, 20, 18, 17, 17, 16, 15, 17, 16, 15, 15, 15, 15, 14, 16, 13, 15, 14, 14, 13, 14, 13, 12, 13, 15, 13, 12, 12, 13, 12, 12, 12, 12, 12, 12, 12, 12, 12, 11, 14, 11, 12, 11, 12, 11, 11, 11, 12, 14, 11, 11, 12, 12, 12, 10, 11, 11, 11, 12, 12, 11, 12, 11, 10, 11, 11, 12, 12, 10, 11, 10, 10, 10, 10, 10, 13, 10, 10, 11, 10, 10, 10, 11, 10, 10, 12, 11, 10, 10, 10, 10, 10, 10, 12, 9, 10, 10, 10, 11, 12, 9, 11, 10, 12, 9, 10, 10, 9, 11, 10, 11, 11, 10, 10, 10, 12, 10, 9, 9, ];

const maxpowUInt32 = Int8[ 0,
31, 20, 15, 14, 12, 11, 10, 10, 10, 9, 11, 9, 9, 9, 7, 8, 8, 8, 8, 9, 8, 7, 8, 8, 7, 8, 9, 6, 6, 9, 6, 7, 6, 7, 6, 6, 6, 7, 6, 7, 7, 6, 6, 6, 8, 8, 6, 7, 8, 7, 6, 8, 6, 8, 6, 6, 6, 6, 6, 6, 7, 6, 5, 6, 5, 5, 5, 5, 7, 6, 5, 5, 5, 5, 6, 5, 5, 5, 5, 5, 5, 5, 5, 6, 7, 6, 5, 6, 6, 5, 5, 6, 5, 5, 5, 5, 7, 5, 6, 5, 5, 5, 5, 5, 6, 8, 6, 5, 5, 5, 6, 7, 5, 5, 5, 6, 7, 5, 5, 4, 6, 5, 5, 9, 7, 6, 4, ];

const maxpowUInt16 = Int8[ 0,
15, 10, 7, 6, 6, 6, 5, 5, 5, 5, 5, 5, 4, 4, 3, 5, 6, 4, 5, 4, 5, 4, 3, 4, 4, 3, 5, 5, 3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 6, 4, 3, 3, 5, 3, 3, 3, 4, 3, 2, 4, 4, 4, 4, 3, 3, 3, 4, 4, 3, 3, 3, 2, 6, 4, 3, 3, 2, 5, 4, 3, 3, 4, 5, 3, 3, 4, 3, 3, 4, 4, 3, 2, 4, 3, 2, 3, 3, 5, 3, 3, 6, 3, 2, 3, 3, 4, 3, 5, 4, 4, 3, 2, 4, 4, 3, 4, 4, 3, 3, 3, 2, 3, 4, 3, 3, 2, 4, 3, 2, 3, 5, 2, 3, 4, 8, 2, ];

const maxpowUInt8 = Int8[ 0,
7, 5, 3, 3, 3, 5, 2, 3, 3, 2, 3, 2, 2, 2, 1, 15, 3, 3, 2, 2, 2, 1, 2, 2, 3, 4, 1, 2, 2, 2, 1, 7, 3, 2, 1, 4, 2, 2, 2, 2, 2, 5, 3, 3, 2, 2, 1, 5, 2, 1, 2, 2, 2, 3, 2, 2, 1, 2, 1, 3, 1, 3, 1, 3, 1, 3, 1, 2, 1, 2, 1, 2, 3, 2, 3, 1, 2, 3, 1, 3, 1, 2, 2, 1, 2, 2, 1, 2, 3, 1, 1, 2, 2, 1, 1, 2, 3, 1, 1, 2, 2, 4, 1, 1, 2, 2, 3, 1, 1, 1, 1, 2, 2, 3, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ];

const maxpowInt128 = Int8[ 0,
63, 54, 49, 45, 42, 40, 38, 36, 35, 34, 33, 32, 31, 31, 31, 29, 29, 28, 28, 28, 28, 27, 27, 27, 27, 26, 25, 25, 25, 25, 24, 25, 25, 24, 24, 24, 23, 24, 23, 23, 23, 23, 22, 22, 23, 23, 22, 22, 22, 23, 22, 21, 21, 23, 21, 21, 21, 21, 21, 22, 21, 21, 22, 20, 20, 21, 20, 21, 20, 20, 21, 20, 21, 20, 20, 20, 20, 20, 19, 19, 19, 20, 20, 19, 20, 19, 19, 20, 19, 19, 19, 19, 19, 19, 19, 19, 20, 19, 19, 18, 18, 18, 18, 19, 19, 18, 18, 19, 18, 18, 18, 19, 18, 18, 18, 18, 19, 18, 18, 18, 18, 19, 18, 18, 18, ];

const maxpowInt64 = Int8[ 0,
62, 39, 31, 27, 24, 23, 20, 19, 18, 20, 18, 17, 16, 16, 15, 15, 15, 14, 14, 14, 15, 13, 15, 13, 14, 13, 13, 12, 12, 13, 12, 12, 13, 13, 12, 12, 12, 11, 11, 12, 11, 12, 11, 11, 11, 12, 11, 12, 11, 11, 11, 10, 10, 10, 10, 11, 11, 10, 10, 11, 10, 11, 10, 10, 10, 10, 10, 12, 10, 10, 10, 10, 10, 10, 11, 10, 10, 9, 9, 9, 9, 9, 9, 10, 10, 10, 9, 9, 9, 10, 10, 9, 9, 11, 9, 9, 10, 9, 10, 9, 9, 11, 9, 9, 9, 9, 9, 9, 9, 10, 9, 11, 9, 9, 9, 9, 10, 9, 9, 10, 9, 9, 9, 10, 9, 9, 8, ];

const maxpowInt32 = Int8[ 0,
30, 19, 15, 14, 11, 11, 10, 9, 10, 8, 10, 9, 8, 7, 7, 7, 7, 7, 7, 7, 6, 6, 7, 7, 6, 7, 7, 6, 6, 7, 6, 6, 6, 6, 5, 5, 5, 5, 5, 7, 6, 6, 5, 5, 7, 5, 5, 6, 5, 6, 5, 6, 5, 7, 6, 5, 5, 5, 5, 5, 6, 5, 5, 5, 5, 5, 5, 5, 7, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 6, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 6, 5, 5, 5, 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 5, 5, 5, 4, 4, 6, 5, 4, 4, 4, 5, 4, 4, 7, 5, 4, 4, ];

const maxpowInt16 = Int8[ 0,
14, 9, 7, 6, 5, 5, 4, 4, 4, 5, 4, 4, 3, 3, 3, 4, 3, 3, 4, 3, 3, 4, 3, 3, 3, 3, 4, 3, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 3, 3, 3, 3, 2, 2, 2, 2, 2, 3, 4, 3, 2, 2, 2, 2, 3, 3, 3, 2, 2, 2, 4, 3, 2, 2, 2, 5, 3, 2, 2, 3, 3, 2, 2, 3, 2, 2, 3, 3, 2, 2, 3, 2, 2, 3, 2, 4, 3, 2, 4, 2, 2, 2, 2, 4, 2, 3, 2, 3, 2, 2, 2, 4, 2, 3, 2, 3, 2, 3, 2, 2, 3, 2, 3, 2, 2, 3, 2, 2, 3, 2, 2, 2, 4, 2, ];

const maxpowInt8 = Int8[ 0,
6, 4, 3, 3, 2, 4, 2, 2, 2, 2, 1, 1, 1, 1, 1, 7, 2, 2, 1, 1, 1, 1, 2, 2, 1, 1, 1, 2, 1, 1, 1, 3, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ];


for (T,A,I) in ((:SafeInt128, :maxpowInt128, :Int128), (:SafeInt64, :maxpowInt64, :Int64),
                (:SafeInt32, :maxpowInt32, :Int32), (:SafeInt16, :maxpowInt16, :Int16),
                (:SafeInt8, :maxpowInt8, :Int8),
                (:SafeUInt128, :maxpowUInt128, :UInt128), (:SafeUInt64, :maxpowUInt64, :UInt64),
                (:SafeUInt32, :maxpowUInt32, :UInt32), (:SafeUInt16, :maxpowUInt16, :UInt16),
                (:SafeUInt8, :maxpowUInt8, :UInt8))
  @eval begin

    function Base.:(^)(x::$T, y::$T)
        if 1 < x < 129
            if y <= $A[x] 
                $T($I(x)^$I(y))
            else
                throw(OverflowError(string(x,"^",y)))
            end
        else
            if !signbit(y)
                ipower(x, y)
            else
                throw(DomainError(string(x,"^(",y,")")))
            end
        end
    end

    function ipower(x::$T, y::$T)
        y === zero($T) && return one($T)
        (x === zero($T) || y === one($T)) && return x
        z = Float64($I(x))^Float64($I(y))
        if !isfinite(z) || z > typemax($T)
            throw(OverflowError(string(x,"^",y)))
        end
        return $T(floor($I,z+0.49999999999999994))
    end
    
  end
end

Base.:(^)(x::S1, y::S1) where {S1<:SafeInteger, S2<:SafeInteger} = (^)(promote(x,y)...,)
Base.:(^)(x::S, y::T) where {S<:SafeInteger, T<:UnsafeInteger} = (^)(promote(x,y)...,)
Base.:(^)(x::T, y::S) where {T<:UnsafeInteger, S<:SafeInteger} = baseint((^)(promote(safeint(x), y)...))
